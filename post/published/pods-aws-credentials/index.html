<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=icon href=/images/favicon.svg><link rel=stylesheet href=/scss/global.min.6bb7b2db0a6acaa206ff65d111ffc3555d65a984184ab12d8f5b202614d2ca89.css><link rel=stylesheet href=/css/prism.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,400&display=swap" rel=stylesheet><title>Securely passing AWS IAM credentials to pods running in any Kubernetes cluster | SRE Treats</title>
<meta name=description content="Securely passing AWS IAM credentials to pods running in any Kubernetes cluster
to create an https://docs.aws.amazon.com/eks/latest/userguide/connector_IAM_role.html
First we need to create an IAM role for your cluster
Register a cluster in EKS with custom name and select the role created above.
It ask you to download a yaml file (It will ask you only once so be sure to download that yaml file without reloading the page.)
Apply the yaml an it will bring up a pod"><meta property="og:title" content="Securely passing AWS IAM credentials to pods running in any Kubernetes cluster | SRE Treats"><meta property="og:site_name" content="SRE Treats"><meta property="og:description" content="Securely passing AWS IAM credentials to pods running in any Kubernetes cluster
to create an https://docs.aws.amazon.com/eks/latest/userguide/connector_IAM_role.html
First we need to create an IAM role for your cluster
Register a cluster in EKS with custom name and select the role created above.
It ask you to download a yaml file (It will ask you only once so be sure to download that yaml file without reloading the page.)
Apply the yaml an it will bring up a pod"><meta property="og:url" content="https://sretreats.github.io/post/published/pods-aws-credentials/"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:image" content='https://sretreats.github.io/uploads/default.jpg'><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Securely passing AWS IAM credentials to pods running in any Kubernetes cluster | SRE Treats"><link rel=canonical href=https://sretreats.github.io/post/published/pods-aws-credentials/><meta name=twitter:description content="Securely passing AWS IAM credentials to pods running in any Kubernetes cluster
to create an https://docs.aws.amazon.com/eks/latest/userguide/connector_IAM_role.html
First we need to create an IAM role for your cluster
Register a cluster in EKS with custom name and select the role created above.
It ask you to download a yaml file (It will ask you only once so be sure to download that yaml file without reloading the page.)
Apply the yaml an it will bring up a pod"><meta name=twitter:image content="https://sretreats.github.io/uploads/default.jpg"><meta property="article:published_time" content="2022-02-06T00:00:00+00:00"><meta property="article:updated_time" content="2022-02-06T00:00:00+00:00"></head><body class=line-numbers><script src=/js/initColors.js></script><div class=layout-styled><section class=section><div class=nav-container><a class=logo-link href=/><svg xmlns="http://www.w3.org/2000/svg" className="Logo__Desktop" width="173.353" height="19" viewBox="0 0 173.353 19.1"><g id="Group_1" data-name="Group 1" transform="translate(116.873 423.728)"><path id="Path_3" style="fill:var(--primary)" class="change-fill" data-name="Path 3" d="M11.728-13.917v2.435a9.494 9.494.0 00-2.192-1.057A7.142 7.142.0 007.321-12.9a4.177 4.177.0 00-2.685.79A2.589 2.589.0 003.65-9.973 2.364 2.364.0 004.3-8.18 5.415 5.415.0 006.715-7.146l1.259.285a6.95 6.95.0 013.635 1.829 4.843 4.843.0 011.14 3.4 4.781 4.781.0 01-1.568 3.861A6.874 6.874.0 016.62 3.556a12.043 12.043.0 01-2.506-.267 14.049 14.049.0 01-2.53-.8V-.067A11.842 11.842.0 004.167 1.2a7.748 7.748.0 002.453.4A4.394 4.394.0 009.447.795a2.757 2.757.0 001.01-2.275 2.765 2.765.0 00-.695-2.031A4.9 4.9.0 007.344-4.592l-1.283-.3A7.224 7.224.0 012.474-6.576 4.118 4.118.0 011.357-9.605a4.862 4.862.0 011.6-3.807A6.126 6.126.0 017.2-14.844a10.7 10.7.0 012.15.232 16.214 16.214.0 012.378.695zM23.381-5.163a3.352 3.352.0 011.58.9 11.02 11.02.0 011.627 2.631L29 3.212H26.422L24.307-1.266a7.061 7.061.0 00-1.645-2.465 3.078 3.078.0 00-1.907-.552H18.463v7.5H16.051v-17.74h4.942A6.745 6.745.0 0125.471-13.2a4.719 4.719.0 011.556 3.813 4.241 4.241.0 01-.956 2.869 4.189 4.189.0 01-2.69 1.355zm-4.918-7.389v6.3h2.625a3.7 3.7.0 002.566-.772A3.052 3.052.0 0024.5-9.391a3.006 3.006.0 00-.9-2.346 3.755 3.755.0 00-2.607-.814zm12.877-1.972H41.864V-12.5H33.739v4.775h7.769v2.019H33.739v6.9H42.09V3.212H31.339z" transform="translate(-82.215 -408.884)" fill="#383838"/><path id="Path_2" data-name="Path 2" d="M.459-14.58h13.53v2.019H8.441V3.155H6.03V-12.561H.459zM28.267-7.405a4.947 4.947.0 00-1.425-.8 4.863 4.863.0 00-1.592-.249 3.856 3.856.0 00-3.124 1.283 5.607 5.607.0 00-1.081 3.706v6.62h-2.2v-13.3h2.2v2.6a4.436 4.436.0 011.681-2.168 4.746 4.746.0 012.691-.754 5.427 5.427.0 011.509.2 4.815 4.815.0 011.342.63zM42.5-4.59v1.069H33.03v.071A5.267 5.267.0 0034.07.458a4.217 4.217.0 003.2 1.188 7.8 7.8.0 002.186-.333A13.409 13.409.0 0041.892.3V2.478a14.744 14.744.0 01-2.405.766 10.39 10.39.0 01-2.239.255A6.326 6.326.0 0132.4 1.64a7.19 7.19.0 01-1.746-5.126 7.314 7.314.0 011.711-5.084 5.836 5.836.0 014.561-1.9 4.989 4.989.0 014.009 1.722A6.614 6.614.0 0142.5-4.59zm-2.186-.641a4.236 4.236.0 00-1-2.382 3.084 3.084.0 00-2.477-1 3.482 3.482.0 00-2.6 1.045A3.687 3.687.0 0033.114-5.22zm11.867 1.7h-.725a5.067 5.067.0 00-2.881.671 2.275 2.275.0 00-.968 2A2.4 2.4.0 0048.33 1a2.857 2.857.0 002.008.665A3.481 3.481.0 0053.177.417a5.336 5.336.0 001.045-3.463v-.487zm4.241-.9v7.59h-2.2V1.183a4.511 4.511.0 01-1.764 1.752 5.451 5.451.0 01-2.584.564 4.525 4.525.0 01-3.243-1.146A4.027 4.027.0 0145.42-.718a4 4 0 011.491-3.374 7.065 7.065.0 014.377-1.152h2.934v-.344a3.006 3.006.0 00-.808-2.31 3.728 3.728.0 00-2.542-.719 8.307 8.307.0 00-2.257.321 9.836 9.836.0 00-2.221.938V-9.544a15.232 15.232.0 012.322-.695 10.55 10.55.0 012.156-.232 7.332 7.332.0 012.821.487 4.434 4.434.0 011.895 1.461 3.685 3.685.0 01.641 1.467A13.313 13.313.0 0156.42-4.436zm9.36-9.491v3.777h4.965v1.7H65.78v7.222A2.955 2.955.0 0066.338.827a2.639 2.639.0 001.948.582h2.459V3.155H68.073A4.894 4.894.0 0164.6 2.169a4.645 4.645.0 01-1.01-3.4v-7.22H60.043v-1.7h3.552v-3.777zM84.691-9.686v2.138a8.327 8.327.0 00-1.889-.82 6.974 6.974.0 00-1.936-.273 4.079 4.079.0 00-2.215.481 1.636 1.636.0 00-.731 1.467 1.605 1.605.0 00.546 1.33 7.449 7.449.0 002.72.855l.879.166a4.284 4.284.0 012.465 1.235 3.458 3.458.0 01.837 2.411 3.713 3.713.0 01-1.4 3.083A6.123 6.123.0 0180.07 3.5 10.951 10.951.0 0178 3.291a18.9 18.9.0 01-2.34-.624V.411A12.648 12.648.0 0078 1.355a7.8 7.8.0 002.114.315 3.721 3.721.0 002.245-.588 1.928 1.928.0 00.8-1.645q0-1.52-2.91-2.1l-.1-.024-.82-.166A5.23 5.23.0 0176.578-4.1a3.231 3.231.0 01-.867-2.382 3.568 3.568.0 011.295-2.952A5.773 5.773.0 0180.7-10.47a10.519 10.519.0 012.055.2A10.37 10.37.0 0184.691-9.686z" transform="translate(-28.889 -408.827)" fill="#939393"/><path id="Path_4" data-name="Path 4" d="M10.615 11.344l1.27.859a7.508 7.508.0 01-1.65 2.612 2.545 2.545.0 01-1.67.7A3.432 3.432.0 016.1 14.093Q5 12.75 4.551 12.188a1.394 1.394.0 00-1.162-.552 1.239 1.239.0 00-1.143.708 15.647 15.647.0 00-.82 1.8L.127 13.4a6.213 6.213.0 011.465-2.666A2.643 2.643.0 013.4 9.879a3.577 3.577.0 012.954 1.953Q7.656 13.8 8.564 13.8a1.439 1.439.0 001.26-.845 12.037 12.037.0 00.791-1.611z" transform="translate(-117 -427)" fill="#4eabd9"/><path id="Union_4" data-name="Union 4" d="M7.409 6.8.0 13.6zM0 0 7.409 6.8z" transform="translate(-99.196 -422.205)" fill="none" stroke="#4eabd9" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/></g></svg>
<span class=header-hidden>Navigate back to the homepage</span></a><div class=nav-controls><button id=copyButton class=icon-wrapper title="Copy link"><svg class="icon-image" width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M2 5C2 3.34328 3.34328 2 5 2h9c1.6567.0 3 1.34328 3 3V9c0 1.6567-1.3433 3-3 3H10C9.44771 12 9 12.4477 9 13S9.44771 14 10 14h4c2.7613.0 5-2.2387 5-5V5c0-2.76128-2.2387-5-5-5H5C2.23872.0.0 2.23872.0 5V9c0 1.4938.656313 2.8361 1.6935 3.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625 3.47028 12.2483 3.43068 11.6164 3.0165 11.2511 2.39169 10.6999 2 9.89621 2 9V5zm5 6c0-1.65672 1.34328-3 3-3h4C14.5523 8 15 7.55228 15 7S14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11v4c0 2.7613 2.23872 5 5 5h9c2.7613.0 5-2.2387 5-5V11C24 9.50621 23.3437 8.16393 22.3065 7.24906 21.8923 6.88372 21.2604 6.92332 20.8951 7.3375 20.5297 7.75168 20.5693 8.38361 20.9835 8.74894 21.6083 9.30007 22 10.1038 22 11v4c0 1.6567-1.3433 3-3 3H10c-1.65672.0-3-1.3433-3-3V11z" fill="#000"/></svg><div id=toolTip class=tool-tip>copied</div><input id=copyText style=opacity:0 type=text class=tool-tip>
</button>
<button id=themeColorButton class=icon-wrapper title="Toggle dark/light mode"><div id=sunRays class=sun-rays></div><div id=moonOrSun class=moon-or-sun></div><div id=moonMask class=moon-mask></div></button></div></div></section><script src=/js/toggleLogos.js></script><script src=/js/toggleColors.js></script><script src=/js/copyUrl.js></script><section class="section narrow"><section id=articleHero class=wide-section><div class=article-hero><header class=article-header><h1 class=article-hero-heading>Securely passing AWS IAM credentials to pods running in any Kubernetes cluster</h1><div class=article-hero-subtitle><div class=article-meta><a href=/authors/hemant-negi/ class=article-author-link><div class=article-author-avatar><img src=/images/authors/hemant-negi.jpg></div><strong>Hemant Negi</strong>
<span class=hide-on-mobile>,&nbsp;</span>
</a><script src=/js/collapseAuthors.js></script><span class=article-date>February 6, 2022
• 2 min read</span></div></div></header></div></section><aside id=progressBar class=aside-container><div class=aside-align><div><div class=overlap-container></div></div></div><div class=progress-container tabindex={-1}><div class=track-line aria-hidden=true><div id=progressIndicator class=progress-line></div></div></div></aside><article id=articleContent class=post-content style=position:relative><p>Securely passing AWS IAM credentials to pods running in any Kubernetes cluster</p><p>to create an <a href=https://docs.aws.amazon.com/eks/latest/userguide/connector_IAM_role.html>https://docs.aws.amazon.com/eks/latest/userguide/connector_IAM_role.html</a></p><ul><li><p>First we need to create an IAM role for your cluster</p></li><li><p>Register a cluster in EKS with custom name and select the role created above.</p></li><li><p>It ask you to download a yaml file (It will ask you only once so be sure to
download that yaml file without reloading the page.)</p></li><li><p>Apply the yaml an it will bring up a pod</p></li></ul><p>Next is we need to create a
curl -o eks-connector-clusterrole.yaml <a href=https://amazon-eks.s3.us-west-2.amazonaws.com/eks-connector/manifests/eks-connector-console-roles/eks-connector-clusterrole.yaml>https://amazon-eks.s3.us-west-2.amazonaws.com/eks-connector/manifests/eks-connector-console-roles/eks-connector-clusterrole.yaml</a></p><ul><li><a href=https://docs.aws.amazon.com/eks/latest/userguide/connector-grant-access.html>https://docs.aws.amazon.com/eks/latest/userguide/connector-grant-access.html</a></li></ul><p>The thing is, we need an open ID Connect issuer isntalled/connected with our
cluster. That will take time.</p><p>Flags required to enable oidc in k8s cluster</p><ul><li>&ndash;oidc-issuer-url=&lt;k8s_oidc_issuer_url> # &lt;&ndash; 🔴 update this<ul><li>&ndash;oidc-client-id=&lt;k8s_oidc_client_id> # &lt;&ndash; 🔴 update this</li><li>&ndash;oidc-username-claim=email # &lt;&ndash; 🔴 update this</li><li>&ndash;oidc-groups-claim=groups # &lt;&ndash; 🔴 update this</li></ul></li></ul><p>This article is great.
<a href=https://mjarosie.github.io/dev/2021/09/15/iam-roles-for-kubernetes-service-accounts-deep-dive.html>https://mjarosie.github.io/dev/2021/09/15/iam-roles-for-kubernetes-service-accounts-deep-dive.html</a>
<a href=https://itnext.io/protect-kubernetes-dashboard-with-openid-connect-104b9e75e39c>https://itnext.io/protect-kubernetes-dashboard-with-openid-connect-104b9e75e39c</a></p><h2 id=steps-in-aws-iam-identity-providers>Steps in aws IAM identity providers</h2><p>For Provider Type, choose OpenID Connect.
For Provider URL, paste the OIDC issuer URL for your cluster, and then choose Get thumbprint.
For Audience, enter sts.amazonaws.com and choose Add provider.</p><h2 id=creating-an-oidc>Creating an OIDC</h2><p>here is a go library that you can drop in your go project to add OIDC provider support.</p><pre tabindex=0><code>Service linked role &#39;arn:aws:iam::751498470000:role/aws-service-role/eks-connector.amazonaws.com/AWSServiceRoleForAmazonEKSConnector&#39; is propagating, please retry later.
</code></pre><p>Troubleshoting - <a href=https://docs.aws.amazon.com/eks/latest/userguide/troubleshooting-connector.html>https://docs.aws.amazon.com/eks/latest/userguide/troubleshooting-connector.html</a></p></article><section id=articleNext class=wide-section><h3 class=footer-next-heading>More articles from SRE Treats</h3><div class=footer-spacer></div><div class=next-articles-grid numberofarticles={numberOfArticles}><div class=post-row><a href=/post/published/linux-administration/ class=article-link id=article-link-bigger><div><div class=image-container><img src=/images/posts/linux-administration.png class=article-image></div><div><h2 class=article-title>Linux Administration Essentials</h2><p class=article-excerpt>A comprehensive guide covering essential Linux commands for memory, disk, and service management, along with log analysis techniques for system administrators.</p><div class=article-metadata>September 23, 2025 · 8 min read</div></div></div></a><a href=/post/published/pods-aws-credentials/ class=article-link><div><div class=image-container><img src class=article-image></div><div><h2 class=article-title>Securely passing AWS IAM credentials to pods running in any Kubernetes cluster</h2><p class=article-excerpt>Passing aws credentials securely to apps running in a Kubernetes cluster is trivial thing. we use KIAM before
to pass credentials to pod. But its depricated as aws has now a very.</p><div class=article-metadata>February 6, 2022 · 2 min read</div></div></div></a></div></div></section></section><script src=/js/progressBar.js></script><div class=footer-gradient></div><div class="section narrow"><div class=footer-hr></div><div class=footer-container><div class=footer-text>© 2025 SRE Treats<div class=footer-links><a href=/about/>About</a></div></div><div class=social-icon-outer><div class=social-icon-container></div></div></div></div></div><script src=/js/prism.js></script></body></html>